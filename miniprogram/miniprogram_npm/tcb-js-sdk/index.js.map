{"version":3,"sources":["index.js","auth/index.js","auth/weixinAuthProvider.js","lib/util.js","auth/base.js","lib/request.js","types.js","../package.json","lib/cache.js","adapters/index.js","adapters/platforms/web.js","lib/events.js","auth/anonymousAuthProvider.js","auth/customAuthProvider.js","storage/index.js","functions/index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA,AGTA;AFOA,ACHA,AFMA,AGTA;AFOA,ACHA,AFMA,AGTA;ACFA,AHSA,ACHA,AFMA,AGTA;ACFA,AHSA,ACHA,AFMA,AGTA;ACFA,AHSA,ACHA,AFMA,AGTA;ACFA,AHSA,ACHA,AFMA,AKfA,AFMA;ACFA,AHSA,ACHA,AFMA,AKfA,AFMA;ACFA,AHSA,ACHA,AFMA,AKfA,AFMA;ACFA,AHSA,ACHA,AFMA,AKfA,AFMA,AGTA;AFOA,AHSA,ACHA,AFMA,AKfA,AFMA,AGTA;AFOA,AHSA,ACHA,AFMA,AKfA,AFMA,AGTA;ACFA,AHSA,AHSA,ACHA,AFMA,AKfA,AFMA,AGTA;ACFA,AHSA,AHSA,ACHA,AFMA,AKfA,AFMA,AGTA;ACFA,AHSA,AHSA,ACHA,AFMA,AKfA,AFMA,AGTA;ACFA,AHSA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AHSA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AHSA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ALeA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ALeA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ALeA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ACHA,ANkBA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ACHA,ANkBA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ACHA,ANkBA,AHSA,ACHA,AFMA,AQxBA,AHSA,AFMA,AGTA;ACFA,AENA,ACHA,ANkBA,AHSA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,ANkBA,AHSA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,ANkBA,AHSA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,AENA,ARwBA,AHSA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,AENA,ARwBA,AHSA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,AENA,ARwBA,AHSA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AGTA;ACFA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA;AIXA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA;AIXA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AENA,ACHA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AavCA,Af6CA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,ACHA,AZoCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;APsBA,AGTA,AENA,AXiCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AGTA,ANkBA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AFMA,AWjCA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AENA,AXiCA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AQxBA,AHSA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AFMA,AKfA,AS3BA;AJaA,AT2BA,ACHA,AGTA,AS3BA;AJaA,AT2BA,ACHA,AGTA,AS3BA;AJaA,AT2BA,ACHA,AGTA,AS3BA;AJaA,AT2BA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AbwCA,ACHA,AGTA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar database_1 = require(\"@cloudbase/database\");\nvar cloudbase_adapter_wx_mp_1 = __importDefault(require(\"cloudbase-adapter-wx_mp\"));\nvar auth_1 = require(\"./auth\");\nvar Storage = __importStar(require(\"./storage\"));\nvar Functions = __importStar(require(\"./functions\"));\nvar request_1 = require(\"./lib/request\");\nvar events_1 = require(\"./lib/events\");\nvar adapters_1 = require(\"./adapters\");\nvar types_1 = require(\"./types\");\nvar util_1 = require(\"./lib/util\");\nvar cache_1 = require(\"./lib/cache\");\nvar DEFAULT_INIT_CONFIG = {\n    timeout: 15000,\n    persistence: 'session'\n};\nvar MAX_TIMEOUT = 1000 * 60 * 10;\nvar MIN_TIMEOUT = 100;\nvar extensionMap = {};\nvar TCB = (function () {\n    function TCB(config) {\n        this.config = config ? config : this.config;\n        this.authObj = undefined;\n        if (adapters_1.Adapter.adapter) {\n            this.requestClient = new adapters_1.Adapter.adapter.reqClass({\n                timeout: this.config.timeout,\n                timeoutMsg: \"[tcb-js-sdk] \\u8BF7\\u6C42\\u5728\" + this.config.timeout / 1000 + \"s\\u5185\\u672A\\u5B8C\\u6210\\uFF0C\\u5DF2\\u4E2D\\u65AD\"\n            });\n        }\n    }\n    TCB.prototype.init = function (config) {\n        if (!adapters_1.Adapter.adapter) {\n            this._useDefaultAdapter();\n            this.requestClient = new adapters_1.Adapter.adapter.reqClass({\n                timeout: config.timeout || 5000,\n                timeoutMsg: \"[tcb-js-sdk] \\u8BF7\\u6C42\\u5728\" + (config.timeout || 5000) / 1000 + \"s\\u5185\\u672A\\u5B8C\\u6210\\uFF0C\\u5DF2\\u4E2D\\u65AD\"\n            });\n        }\n        if (adapters_1.Adapter.runtime !== adapters_1.RUNTIME.WEB) {\n            if (!config.appSecret) {\n                throw new Error('[tcb-js-sdk]参数错误：请正确配置appSecret');\n            }\n            var appSign = adapters_1.Adapter.adapter.getAppSign ? adapters_1.Adapter.adapter.getAppSign() : '';\n            if (config.appSign && appSign && config.appSign !== appSign) {\n                throw new Error('[tcb-js-sdk]参数错误：非法的应用标识');\n            }\n            appSign && (config.appSign = appSign);\n            if (!config.appSign) {\n                throw new Error('[tcb-js-sdk]参数错误：请正确配置应用标识');\n            }\n        }\n        this.config = __assign(__assign({}, DEFAULT_INIT_CONFIG), config);\n        switch (true) {\n            case this.config.timeout > MAX_TIMEOUT:\n                console.warn('[tcb-js-sdk] timeout大于可配置上限[10分钟]，已重置为上限数值');\n                this.config.timeout = MAX_TIMEOUT;\n                break;\n            case this.config.timeout < MIN_TIMEOUT:\n                console.warn('[tcb-js-sdk] timeout小于可配置下限[100ms]，已重置为下限数值');\n                this.config.timeout = MIN_TIMEOUT;\n                break;\n        }\n        return new TCB(this.config);\n    };\n    TCB.prototype.database = function (dbConfig) {\n        database_1.Db.reqClass = request_1.IRequest;\n        database_1.Db.wsClass = adapters_1.Adapter.adapter.wsClass;\n        if (!this.authObj) {\n            console.warn('需要app.auth()授权');\n            return;\n        }\n        database_1.Db.getAccessToken = this.authObj.getAccessToken.bind(this.authObj);\n        database_1.Db.runtime = adapters_1.Adapter.runtime;\n        if (adapters_1.Adapter.runtime !== adapters_1.RUNTIME.WEB) {\n            database_1.Db.dataVersion = types_1.dataVersion;\n            database_1.Db.createSign = util_1.createSign;\n            database_1.Db.appSecretInfo = __assign({ appSign: this.config.appSign }, this.config.appSecret);\n        }\n        if (!database_1.Db.ws) {\n            database_1.Db.ws = null;\n        }\n        return new database_1.Db(__assign(__assign({}, this.config), dbConfig));\n    };\n    TCB.prototype.auth = function (_a) {\n        var persistence = (_a === void 0 ? {} : _a).persistence;\n        if (this.authObj) {\n            console.warn('tcb实例只存在一个auth对象');\n            return this.authObj;\n        }\n        var _persistence = persistence || adapters_1.Adapter.adapter.primaryStorage || DEFAULT_INIT_CONFIG.persistence;\n        if (_persistence !== this.config.persistence) {\n            this.config.persistence = _persistence;\n        }\n        cache_1.initCache(this.config);\n        request_1.initRequest(this.config);\n        this.authObj = new auth_1.Auth(this.config);\n        return this.authObj;\n    };\n    TCB.prototype.on = function (eventName, callback) {\n        return events_1.addEventListener.apply(this, [eventName, callback]);\n    };\n    TCB.prototype.off = function (eventName, callback) {\n        return events_1.removeEventListener.apply(this, [eventName, callback]);\n    };\n    TCB.prototype.callFunction = function (params, callback) {\n        return Functions.callFunction.apply(this, [params, callback]);\n    };\n    TCB.prototype.deleteFile = function (params, callback) {\n        return Storage.deleteFile.apply(this, [params, callback]);\n    };\n    TCB.prototype.getTempFileURL = function (params, callback) {\n        return Storage.getTempFileURL.apply(this, [params, callback]);\n    };\n    TCB.prototype.downloadFile = function (params, callback) {\n        return Storage.downloadFile.apply(this, [params, callback]);\n    };\n    TCB.prototype.uploadFile = function (params, callback) {\n        return Storage.uploadFile.apply(this, [params, callback]);\n    };\n    TCB.prototype.getUploadMetadata = function (params, callback) {\n        return Storage.getUploadMetadata.apply(this, [params, callback]);\n    };\n    TCB.prototype.registerExtension = function (ext) {\n        extensionMap[ext.name] = ext;\n    };\n    TCB.prototype.invokeExtension = function (name, opts) {\n        return __awaiter(this, void 0, void 0, function () {\n            var ext, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        ext = extensionMap[name];\n                        if (!ext) {\n                            throw Error(\"\\u6269\\u5C55\" + name + \" \\u5FC5\\u987B\\u5148\\u6CE8\\u518C\");\n                        }\n                        return [4, ext.invoke(opts, this)];\n                    case 1:\n                        res = _a.sent();\n                        return [2, res];\n                }\n            });\n        });\n    };\n    TCB.prototype.useAdapters = function (adapters) {\n        var _a = adapters_1.useAdapters(adapters) || {}, adapter = _a.adapter, runtime = _a.runtime;\n        adapter && (adapters_1.Adapter.adapter = adapter);\n        runtime && (adapters_1.Adapter.runtime = runtime);\n    };\n    TCB.prototype._useDefaultAdapter = function () {\n        var _a = adapters_1.useDefaultAdapter(), adapter = _a.adapter, runtime = _a.runtime;\n        adapters_1.Adapter.adapter = adapter;\n        adapters_1.Adapter.runtime = runtime;\n    };\n    return TCB;\n}());\nvar tcb = new TCB();\ntcb.useAdapters(cloudbase_adapter_wx_mp_1.default);\ntry {\n    window['tcb'] = tcb;\n}\ncatch (e) {\n}\nmodule.exports = tcb;\n","\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar weixinAuthProvider_1 = require(\"./weixinAuthProvider\");\nvar anonymousAuthProvider_1 = require(\"./anonymousAuthProvider\");\nvar base_1 = require(\"./base\");\nvar cache_1 = require(\"../lib/cache\");\nvar request_1 = require(\"../lib/request\");\nvar events_1 = require(\"../lib/events\");\nvar customAuthProvider_1 = require(\"./customAuthProvider\");\nvar Auth = (function () {\n    function Auth(config) {\n        this.config = config;\n        this._cache = cache_1.getCache(config.env);\n        this._request = request_1.getRequestByEnvId(config.env);\n        this._onAnonymousConverted = this._onAnonymousConverted.bind(this);\n        this._onLoginTypeChanged = this._onLoginTypeChanged.bind(this);\n        events_1.addEventListener(events_1.EVENTS.LOGIN_TYPE_CHANGED, this._onLoginTypeChanged);\n    }\n    Object.defineProperty(Auth.prototype, \"loginType\", {\n        get: function () {\n            return this._cache.getStore(this._cache.keys.loginTypeKey);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Auth.prototype.weixinAuthProvider = function (_a) {\n        var appid = _a.appid, scope = _a.scope, state = _a.state;\n        return new weixinAuthProvider_1.WeixinAuthProvider(this.config, appid, scope, state);\n    };\n    Auth.prototype.anonymousAuthProvider = function () {\n        return new anonymousAuthProvider_1.AnonymousAuthProvider(this.config);\n    };\n    Auth.prototype.customAuthProvider = function () {\n        return new customAuthProvider_1.CustomAuthProvider(this.config);\n    };\n    Auth.prototype.signInAnonymously = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, new anonymousAuthProvider_1.AnonymousAuthProvider(this.config).signIn()];\n            });\n        });\n    };\n    Auth.prototype.linkAndRetrieveDataWithTicket = function (ticket) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this._anonymousAuthProvider) {\n                            this._anonymousAuthProvider = new anonymousAuthProvider_1.AnonymousAuthProvider(this.config);\n                        }\n                        events_1.addEventListener(events_1.EVENTS.ANONYMOUS_CONVERTED, this._onAnonymousConverted);\n                        return [4, this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(ticket)];\n                    case 1:\n                        result = _a.sent();\n                        return [2, result];\n                }\n            });\n        });\n    };\n    Auth.prototype.signOut = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, refreshTokenKey, accessTokenKey, accessTokenExpireKey, action, refresh_token, res;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (this.loginType === base_1.LOGINTYPE.ANONYMOUS) {\n                            throw new Error('[tcb-js-sdk] 匿名用户不支持登出操作');\n                        }\n                        _a = this._cache.keys, refreshTokenKey = _a.refreshTokenKey, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey;\n                        action = 'auth.logout';\n                        refresh_token = this._cache.getStore(refreshTokenKey);\n                        if (!refresh_token) {\n                            return [2];\n                        }\n                        return [4, this._request.send(action, { refresh_token: refresh_token })];\n                    case 1:\n                        res = _b.sent();\n                        this._cache.removeStore(refreshTokenKey);\n                        this._cache.removeStore(accessTokenKey);\n                        this._cache.removeStore(accessTokenExpireKey);\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_STATE_CHANGED);\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_TYPE_CHANGED, {\n                            env: this.config.env,\n                            loginType: base_1.LOGINTYPE.NULL,\n                            persistence: this.config.persistence\n                        });\n                        return [2, res];\n                }\n            });\n        });\n    };\n    Auth.prototype.onLoginStateChanged = function (callback) {\n        var _this = this;\n        events_1.addEventListener(events_1.EVENTS.LOGIN_STATE_CHANGED, function () {\n            var loginState = _this.hasLoginState();\n            callback.call(_this, loginState);\n        });\n        var loginState = this.hasLoginState();\n        callback.call(this, loginState);\n    };\n    Auth.prototype.onLoginStateExpired = function (callback) {\n        events_1.addEventListener(events_1.EVENTS.LOGIN_STATE_EXPIRED, callback.bind(this));\n    };\n    Auth.prototype.onAccessTokenRefreshed = function (callback) {\n        events_1.addEventListener(events_1.EVENTS.ACCESS_TOKEN_REFRESHD, callback.bind(this));\n    };\n    Auth.prototype.onAnonymousConverted = function (callback) {\n        events_1.addEventListener(events_1.EVENTS.ANONYMOUS_CONVERTED, callback.bind(this));\n    };\n    Auth.prototype.onLoginTypeChanged = function (callback) {\n        var _this = this;\n        events_1.addEventListener(events_1.EVENTS.LOGIN_TYPE_CHANGED, function () {\n            var loginState = _this.hasLoginState();\n            callback.call(_this, loginState);\n        });\n    };\n    Auth.prototype.getAccessToken = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = {};\n                        return [4, this._request.getAccessToken()];\n                    case 1: return [2, (_a.accessToken = (_b.sent()).accessToken,\n                            _a.env = this.config.env,\n                            _a)];\n                }\n            });\n        });\n    };\n    Auth.prototype.hasLoginState = function () {\n        var _a = this._cache.keys, refreshTokenKey = _a.refreshTokenKey, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey;\n        var refreshToken = this._cache.getStore(refreshTokenKey);\n        var accessToken = this._cache.getStore(accessTokenKey);\n        var accessTokenExpire = this._cache.getStore(accessTokenExpireKey);\n        if (accessToken && accessTokenExpire > new Date().getTime()) {\n            return {\n                isAnonymous: this.loginType === base_1.LOGINTYPE.ANONYMOUS,\n                credential: {\n                    refreshToken: refreshToken,\n                    accessToken: this._cache.getStore(accessTokenKey)\n                }\n            };\n        }\n        else {\n            return null;\n        }\n    };\n    Auth.prototype.getLoginState = function () {\n        return Promise.resolve(this.hasLoginState());\n    };\n    Auth.prototype.signInWithTicket = function (ticket) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, new customAuthProvider_1.CustomAuthProvider(this.config).signIn(ticket)];\n            });\n        });\n    };\n    Auth.prototype.shouldRefreshAccessToken = function (hook) {\n        this._request._shouldRefreshAccessTokenHook = hook.bind(this);\n    };\n    Auth.prototype.getUserInfo = function () {\n        var action = 'auth.getUserInfo';\n        return this._request.send(action, {}).then(function (res) {\n            if (res.code) {\n                return res;\n            }\n            else {\n                return __assign(__assign({}, res.data), { requestId: res.seqId });\n            }\n        });\n    };\n    Auth.prototype.getAuthHeader = function () {\n        var _a = this._cache.keys, refreshTokenKey = _a.refreshTokenKey, accessTokenKey = _a.accessTokenKey;\n        var refreshToken = this._cache.getStore(refreshTokenKey);\n        var accessToken = this._cache.getStore(accessTokenKey);\n        return {\n            'x-cloudbase-credentials': accessToken + '/@@/' + refreshToken\n        };\n    };\n    Auth.prototype._onAnonymousConverted = function (ev) {\n        var env = ev.data.env;\n        if (env !== this.config.env) {\n            return;\n        }\n        this._cache.updatePersistence(this.config.persistence);\n    };\n    Auth.prototype._onLoginTypeChanged = function (ev) {\n        var _a = ev.data, loginType = _a.loginType, persistence = _a.persistence, env = _a.env;\n        if (env !== this.config.env) {\n            return;\n        }\n        this._cache.updatePersistence(persistence);\n        this._cache.setStore(this._cache.keys.loginTypeKey, loginType);\n    };\n    return Auth;\n}());\nexports.Auth = Auth;\n","\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util = __importStar(require(\"../lib/util\"));\nvar base_1 = require(\"./base\");\nvar events_1 = require(\"../lib/events\");\nvar adapters_1 = require(\"../adapters\");\nvar AllowedScopes;\n(function (AllowedScopes) {\n    AllowedScopes[\"snsapi_base\"] = \"snsapi_base\";\n    AllowedScopes[\"snsapi_userinfo\"] = \"snsapi_userinfo\";\n    AllowedScopes[\"snsapi_login\"] = \"snsapi_login\";\n})(AllowedScopes || (AllowedScopes = {}));\nvar SignInPromiseMap = {};\nvar WeixinAuthProvider = (function (_super) {\n    __extends(WeixinAuthProvider, _super);\n    function WeixinAuthProvider(config, appid, scope, state) {\n        var _this = _super.call(this, config) || this;\n        _this.config = config;\n        _this.appid = appid;\n        _this.scope = adapters_1.Adapter.runtime === adapters_1.RUNTIME.WX_MP ? 'snsapi_base' : scope;\n        _this.state = state || 'weixin';\n        return _this;\n    }\n    WeixinAuthProvider.prototype.signInWithRedirect = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, this.redirect()];\n            });\n        });\n    };\n    WeixinAuthProvider.prototype.getRedirectResult = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var code;\n            return __generator(this, function (_a) {\n                code = util.getWeixinCode();\n                if (!code) {\n                    return [2, null];\n                }\n                return [2, this._signInWithCode(code)];\n            });\n        });\n    };\n    WeixinAuthProvider.prototype.signIn = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var result, err, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!SignInPromiseMap[this.config.env]) {\n                            SignInPromiseMap[this.config.env] = this._signIn();\n                        }\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4, SignInPromiseMap[this.config.env]];\n                    case 2:\n                        result = _a.sent();\n                        return [3, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        err = e_1;\n                        return [3, 4];\n                    case 4:\n                        SignInPromiseMap[this.config.env] = null;\n                        if (err) {\n                            throw err;\n                        }\n                        return [2, result];\n                }\n            });\n        });\n    };\n    WeixinAuthProvider.prototype._signIn = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, accessTokenKey, accessTokenExpireKey, refreshTokenKey, accessToken, accessTokenExpire, code;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this._cache.keys, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey, refreshTokenKey = _a.refreshTokenKey;\n                        accessToken = this._cache.getStore(accessTokenKey);\n                        accessTokenExpire = this._cache.getStore(accessTokenExpireKey);\n                        if (accessToken) {\n                            if (accessTokenExpire && accessTokenExpire > Date.now()) {\n                                return [2, {\n                                        credential: {\n                                            accessToken: accessToken,\n                                            refreshToken: this._cache.getStore(refreshTokenKey)\n                                        }\n                                    }];\n                            }\n                            else {\n                                this._cache.removeStore(accessTokenKey);\n                                this._cache.removeStore(accessTokenExpireKey);\n                            }\n                        }\n                        if (Object.values(AllowedScopes).includes(AllowedScopes[this.scope]) === false) {\n                            throw new Error('错误的scope类型');\n                        }\n                        if (!(adapters_1.Adapter.runtime === adapters_1.RUNTIME.WX_MP)) return [3, 2];\n                        return [4, util.getMiniAppCode()];\n                    case 1:\n                        code = _b.sent();\n                        return [3, 3];\n                    case 2:\n                        code = util.getWeixinCode();\n                        if (!code) {\n                            return [2, this.redirect()];\n                        }\n                        _b.label = 3;\n                    case 3: return [2, this._signInWithCode(code)];\n                }\n            });\n        });\n    };\n    WeixinAuthProvider.prototype.redirect = function () {\n        var currUrl = util.removeParam('code', location.href);\n        currUrl = util.removeParam('state', currUrl);\n        currUrl = encodeURIComponent(currUrl);\n        var host = '//open.weixin.qq.com/connect/oauth2/authorize';\n        if (this.scope === 'snsapi_login') {\n            host = '//open.weixin.qq.com/connect/qrconnect';\n        }\n        location.href = host + \"?appid=\" + this.appid + \"&redirect_uri=\" + currUrl + \"&response_type=code&scope=\" + this.scope + \"&state=\" + this.state + \"#wechat_redirect\";\n    };\n    WeixinAuthProvider.prototype._signInWithCode = function (code) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, accessTokenKey, accessTokenExpireKey, refreshTokenKey, loginType, refreshTokenRes, refreshToken;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this._cache.keys, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey, refreshTokenKey = _a.refreshTokenKey;\n                        loginType = (function (scope) {\n                            switch (scope) {\n                                case AllowedScopes.snsapi_login:\n                                    return 'WECHAT-OPEN';\n                                default:\n                                    return 'WECHAT-PUBLIC';\n                            }\n                        })(this.scope);\n                        return [4, this.getRefreshTokenByWXCode(this.appid, loginType, code)];\n                    case 1:\n                        refreshTokenRes = _b.sent();\n                        refreshToken = refreshTokenRes.refreshToken;\n                        this._cache.setStore(refreshTokenKey, refreshToken);\n                        if (refreshTokenRes.accessToken) {\n                            this._cache.setStore(accessTokenKey, refreshTokenRes.accessToken);\n                        }\n                        if (refreshTokenRes.accessTokenExpire) {\n                            this._cache.setStore(accessTokenExpireKey, refreshTokenRes.accessTokenExpire + Date.now());\n                        }\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_STATE_CHANGED);\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_TYPE_CHANGED, { loginType: base_1.LOGINTYPE.WECHAT, persistence: this.config.persistence });\n                        return [2, {\n                                credential: {\n                                    refreshToken: refreshToken\n                                }\n                            }];\n                }\n            });\n        });\n    };\n    WeixinAuthProvider.prototype.getRefreshTokenByWXCode = function (appid, loginType, code) {\n        return __awaiter(this, void 0, void 0, function () {\n            var action, hybridMiniapp;\n            return __generator(this, function (_a) {\n                action = 'auth.getJwt';\n                hybridMiniapp = adapters_1.Adapter.runtime === adapters_1.RUNTIME.WX_MP ? '1' : '0';\n                return [2, this._request.send(action, { appid: appid, loginType: loginType, code: code, hybridMiniapp: hybridMiniapp }).then(function (res) {\n                        if (res.code) {\n                            throw new Error(\"[tcb-js-sdk] \\u5FAE\\u4FE1\\u767B\\u5F55\\u5931\\u8D25: \" + res.code);\n                        }\n                        if (res.refresh_token) {\n                            return {\n                                refreshToken: res.refresh_token,\n                                accessToken: res.access_token,\n                                accessTokenExpire: res.access_token_expire\n                            };\n                        }\n                        else {\n                            throw new Error(\"[tcb-js-sdk] getJwt\\u672A\\u8FD4\\u56DErefreshToken\");\n                        }\n                    })];\n            });\n        });\n    };\n    return WeixinAuthProvider;\n}(base_1.AuthProvider));\nexports.WeixinAuthProvider = WeixinAuthProvider;\n","\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar hmac_sha256_1 = __importDefault(require(\"crypto-js/hmac-sha256\"));\nvar enc_base64_1 = __importDefault(require(\"crypto-js/enc-base64\"));\nvar enc_utf8_1 = __importDefault(require(\"crypto-js/enc-utf8\"));\nexports.getQuery = function (name, url) {\n    if (typeof window === 'undefined') {\n        return false;\n    }\n    var u = url || window.location.search;\n    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');\n    var r = u.substr(u.indexOf('?') + 1).match(reg);\n    return r != null ? r[2] : '';\n};\nexports.getHash = function (name) {\n    if (typeof window === 'undefined') {\n        return '';\n    }\n    var matches = window.location.hash.match(new RegExp(\"[#?&/]\" + name + \"=([^&#]*)\"));\n    return matches ? matches[1] : '';\n};\nexports.removeParam = function (key, sourceURL) {\n    var rtn = sourceURL.split('?')[0];\n    var param;\n    var params_arr = [];\n    var queryString = sourceURL.indexOf('?') !== -1 ? sourceURL.split('?')[1] : '';\n    if (queryString !== '') {\n        params_arr = queryString.split('&');\n        for (var i = params_arr.length - 1; i >= 0; i -= 1) {\n            param = params_arr[i].split('=')[0];\n            if (param === key) {\n                params_arr.splice(i, 1);\n            }\n        }\n        rtn = rtn + '?' + params_arr.join('&');\n    }\n    return rtn;\n};\nexports.createPromiseCallback = function () {\n    var cb;\n    if (!Promise) {\n        cb = function () { };\n        cb.promise = {};\n        var throwPromiseNotDefined = function () {\n            throw new Error('Your Node runtime does support ES6 Promises. ' +\n                'Set \"global.Promise\" to your preferred implementation of promises.');\n        };\n        Object.defineProperty(cb.promise, 'then', { get: throwPromiseNotDefined });\n        Object.defineProperty(cb.promise, 'catch', { get: throwPromiseNotDefined });\n        return cb;\n    }\n    var promise = new Promise(function (resolve, reject) {\n        cb = function (err, data) {\n            if (err)\n                return reject(err);\n            return resolve(data);\n        };\n    });\n    cb.promise = promise;\n    return cb;\n};\nexports.getWeixinCode = function () {\n    return exports.getQuery('code') || exports.getHash('code');\n};\nexports.getMiniAppCode = function () {\n    return new Promise(function (resolve, reject) {\n        wx.login({\n            success: function (res) {\n                resolve(res.code);\n            },\n            fail: function (err) {\n                reject(err);\n            }\n        });\n    });\n};\nfunction isArray(val) {\n    return Object.prototype.toString.call(val) === '[object Array]';\n}\nexports.isArray = isArray;\nfunction isString(val) {\n    return typeof val === 'string';\n}\nexports.isString = isString;\nfunction isUndefined(val) {\n    return typeof val === 'undefined';\n}\nexports.isUndefined = isUndefined;\nfunction isNull(val) {\n    return Object.prototype.toString.call(val) === '[object Null]';\n}\nexports.isNull = isNull;\nfunction isInstanceOf(instance, construct) {\n    return instance instanceof construct;\n}\nexports.isInstanceOf = isInstanceOf;\nfunction isFormData(val) {\n    return Object.prototype.toString.call(val) === '[object FormData]';\n}\nexports.isFormData = isFormData;\nfunction genSeqId() {\n    return Math.random().toString(16).slice(2);\n}\nexports.genSeqId = genSeqId;\nfunction getArgNames(fn) {\n    var funStr = fn.toString();\n    return funStr.slice(funStr.indexOf('(') + 1, funStr.indexOf(')')).match(/([^\\s,]+)/g);\n}\nexports.getArgNames = getArgNames;\nfunction formatUrl(protocol, url, query) {\n    if (query === void 0) { query = {}; }\n    var urlHasQuery = /\\?/.test(url);\n    var queryString = '';\n    for (var key in query) {\n        if (queryString === '') {\n            !urlHasQuery && (url += '?');\n        }\n        else {\n            queryString += '&';\n        }\n        queryString += key + \"=\" + encodeURIComponent(query[key]);\n    }\n    url += queryString;\n    if (/^http(s)?\\:\\/\\//.test(url)) {\n        return url;\n    }\n    return \"\" + protocol + url;\n}\nexports.formatUrl = formatUrl;\nfunction toQueryString(query) {\n    if (query === void 0) { query = {}; }\n    var queryString = [];\n    for (var key in query) {\n        queryString.push(key + \"=\" + encodeURIComponent(query[key]));\n    }\n    return queryString.join('&');\n}\nexports.toQueryString = toQueryString;\nfunction base64url(source) {\n    var encodedSource = enc_base64_1.default.stringify(source);\n    encodedSource = encodedSource.replace(/=+$/, '');\n    encodedSource = encodedSource.replace(/\\+/g, '-');\n    encodedSource = encodedSource.replace(/\\//g, '_');\n    return encodedSource;\n}\nfunction createSign(payload, secret) {\n    var header = {\n        alg: 'HS256',\n        typ: 'JWT'\n    };\n    var headerStr = base64url(enc_utf8_1.default.parse(JSON.stringify(header)));\n    var payloadStr = base64url(enc_utf8_1.default.parse(JSON.stringify(payload)));\n    var token = headerStr + \".\" + payloadStr;\n    var sign = base64url(hmac_sha256_1.default(token, secret));\n    return token + \".\" + sign;\n}\nexports.createSign = createSign;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar request_1 = require(\"../lib/request\");\nvar cache_1 = require(\"../lib/cache\");\nvar LOGINTYPE;\n(function (LOGINTYPE) {\n    LOGINTYPE[\"ANONYMOUS\"] = \"ANONYMOUS\";\n    LOGINTYPE[\"WECHAT\"] = \"WECHAT\";\n    LOGINTYPE[\"CUSTOM\"] = \"CUSTOM\";\n    LOGINTYPE[\"NULL\"] = \"NULL\";\n})(LOGINTYPE = exports.LOGINTYPE || (exports.LOGINTYPE = {}));\nvar AuthProvider = (function () {\n    function AuthProvider(config) {\n        this.config = config;\n        this._cache = cache_1.getCache(config.env);\n        this._request = request_1.getRequestByEnvId(config.env);\n    }\n    AuthProvider.prototype.setRefreshToken = function (refreshToken) {\n        var _a = this._cache.keys, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey, refreshTokenKey = _a.refreshTokenKey;\n        this._cache.removeStore(accessTokenKey);\n        this._cache.removeStore(accessTokenExpireKey);\n        this._cache.setStore(refreshTokenKey, refreshToken);\n    };\n    return AuthProvider;\n}());\nexports.AuthProvider = AuthProvider;\n","\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar types_1 = require(\"../types\");\nvar cache_1 = require(\"./cache\");\nvar events_1 = require(\"./events\");\nvar util_1 = require(\"./util\");\nvar adapters_1 = require(\"../adapters\");\nvar base_1 = require(\"../auth/base\");\nvar actionsWithoutAccessToken = [\n    'auth.getJwt',\n    'auth.logout',\n    'auth.signInWithTicket',\n    'auth.signInAnonymously'\n];\nvar commonHeader = {\n    'X-SDK-Version': types_1.SDK_VERISON\n};\nfunction bindHooks(instance, name, hooks) {\n    var originMethod = instance[name];\n    instance[name] = function (options) {\n        var data = {};\n        var headers = {};\n        hooks.forEach(function (hook) {\n            var _a = hook.call(instance, options), appendedData = _a.data, appendedHeaders = _a.headers;\n            Object.assign(data, appendedData);\n            Object.assign(headers, appendedHeaders);\n        });\n        var originData = options.data;\n        originData && (function () {\n            if (util_1.isFormData(originData)) {\n                for (var key in data) {\n                    originData.append(key, data[key]);\n                }\n                return;\n            }\n            options.data = __assign(__assign({}, originData), data);\n        })();\n        options.headers = __assign(__assign({}, (options.headers || {})), headers);\n        return originMethod.call(instance, options);\n    };\n}\nfunction beforeEach() {\n    var seqId = util_1.genSeqId();\n    return {\n        data: {\n            seqId: seqId\n        },\n        headers: __assign(__assign({}, commonHeader), { 'x-seqid': seqId })\n    };\n}\nvar IRequest = (function () {\n    function IRequest(config) {\n        if (config === void 0) { config = {}; }\n        this.config = config;\n        this._reqClass = new adapters_1.Adapter.adapter.reqClass({\n            timeout: this.config.timeout,\n            timeoutMsg: \"[tcb-js-sdk] \\u8BF7\\u6C42\\u5728\" + this.config.timeout / 1000 + \"s\\u5185\\u672A\\u5B8C\\u6210\\uFF0C\\u5DF2\\u4E2D\\u65AD\",\n            restrictedMethods: ['post']\n        });\n        this._cache = cache_1.getCache(this.config.env);\n        this._localCache = cache_1.getLocalCache(this.config.env);\n        bindHooks(this._reqClass, 'post', [beforeEach]);\n        bindHooks(this._reqClass, 'upload', [beforeEach]);\n        bindHooks(this._reqClass, 'download', [beforeEach]);\n    }\n    IRequest.prototype.post = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this._reqClass.post(options)];\n                    case 1:\n                        res = _a.sent();\n                        return [2, res];\n                }\n            });\n        });\n    };\n    IRequest.prototype.upload = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this._reqClass.upload(options)];\n                    case 1:\n                        res = _a.sent();\n                        return [2, res];\n                }\n            });\n        });\n    };\n    IRequest.prototype.download = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this._reqClass.download(options)];\n                    case 1:\n                        res = _a.sent();\n                        return [2, res];\n                }\n            });\n        });\n    };\n    IRequest.prototype.refreshAccessToken = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var result, err, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this._refreshAccessTokenPromise) {\n                            this._refreshAccessTokenPromise = this._refreshAccessToken();\n                        }\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4, this._refreshAccessTokenPromise];\n                    case 2:\n                        result = _a.sent();\n                        return [3, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        err = e_1;\n                        return [3, 4];\n                    case 4:\n                        this._refreshAccessTokenPromise = null;\n                        this._shouldRefreshAccessTokenHook = null;\n                        if (err) {\n                            throw err;\n                        }\n                        return [2, result];\n                }\n            });\n        });\n    };\n    IRequest.prototype._refreshAccessToken = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, accessTokenKey, accessTokenExpireKey, refreshTokenKey, loginTypeKey, anonymousUuidKey, refreshToken, params, isAnonymous, response, code;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this._cache.keys, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey, refreshTokenKey = _a.refreshTokenKey, loginTypeKey = _a.loginTypeKey, anonymousUuidKey = _a.anonymousUuidKey;\n                        this._cache.removeStore(accessTokenKey);\n                        this._cache.removeStore(accessTokenExpireKey);\n                        refreshToken = this._cache.getStore(refreshTokenKey);\n                        if (!refreshToken) {\n                            throw new Error('[tcb-js-sdk] 未登录CloudBase');\n                        }\n                        params = {\n                            refresh_token: refreshToken,\n                        };\n                        isAnonymous = this._cache.getStore(loginTypeKey) === base_1.LOGINTYPE.ANONYMOUS;\n                        if (isAnonymous) {\n                            params.anonymous_uuid = this._cache.getStore(anonymousUuidKey);\n                        }\n                        return [4, this.request('auth.getJwt', params)];\n                    case 1:\n                        response = _b.sent();\n                        if (response.data.code) {\n                            code = response.data.code;\n                            if (code === 'SIGN_PARAM_INVALID' || code === 'REFRESH_TOKEN_EXPIRED' || code === 'INVALID_REFRESH_TOKEN') {\n                                events_1.activateEvent(events_1.EVENTS.LOGIN_STATE_EXPIRED);\n                                this._cache.removeStore(refreshTokenKey);\n                            }\n                            throw new Error(\"[tcb-js-sdk] \\u5237\\u65B0access token\\u5931\\u8D25\\uFF1A\" + response.data.code);\n                        }\n                        if (response.data.access_token) {\n                            events_1.activateEvent(events_1.EVENTS.ACCESS_TOKEN_REFRESHD);\n                            this._cache.setStore(accessTokenKey, response.data.access_token);\n                            this._cache.setStore(accessTokenExpireKey, response.data.access_token_expire + Date.now());\n                            return [2, {\n                                    accessToken: response.data.access_token,\n                                    accessTokenExpire: response.data.access_token_expire\n                                }];\n                        }\n                        if (response.data.refresh_token) {\n                            this._cache.removeStore(refreshTokenKey);\n                            this._cache.setStore(refreshTokenKey, response.data.refresh_token);\n                            this._refreshAccessToken();\n                        }\n                        return [2];\n                }\n            });\n        });\n    };\n    IRequest.prototype.getAccessToken = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, accessTokenKey, accessTokenExpireKey, accessToken, accessTokenExpire, shouldRefreshAccessToken, _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this._cache.keys, accessTokenKey = _a.accessTokenKey, accessTokenExpireKey = _a.accessTokenExpireKey;\n                        accessToken = this._cache.getStore(accessTokenKey);\n                        accessTokenExpire = this._cache.getStore(accessTokenExpireKey);\n                        shouldRefreshAccessToken = true;\n                        _b = this._shouldRefreshAccessTokenHook;\n                        if (!_b) return [3, 2];\n                        return [4, this._shouldRefreshAccessTokenHook(accessToken, accessTokenExpire)];\n                    case 1:\n                        _b = !(_c.sent());\n                        _c.label = 2;\n                    case 2:\n                        if (_b) {\n                            shouldRefreshAccessToken = false;\n                        }\n                        if ((!accessToken || !accessTokenExpire || accessTokenExpire < Date.now()) && shouldRefreshAccessToken) {\n                            return [2, this.refreshAccessToken()];\n                        }\n                        else {\n                            return [2, {\n                                    accessToken: accessToken,\n                                    accessTokenExpire: accessTokenExpire\n                                }];\n                        }\n                        return [2];\n                }\n            });\n        });\n    };\n    IRequest.prototype.request = function (action, params, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tcbTraceKey, contentType, tmpObj, _a, payload, key, key, _b, appSign, appSecret, timestamp, appAccessKey, appAccessKeyId, sign, opts, traceHeader, parse, inQuery, search, formatQuery, newUrl, res, resTraceHeader;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        tcbTraceKey = \"x-tcb-trace_\" + this.config.env;\n                        contentType = 'application/x-www-form-urlencoded';\n                        tmpObj = __assign({ action: action,\n                            dataVersion: types_1.dataVersion, env: this.config.env }, params);\n                        if (!(actionsWithoutAccessToken.indexOf(action) === -1)) return [3, 2];\n                        _a = tmpObj;\n                        return [4, this.getAccessToken()];\n                    case 1:\n                        _a.access_token = (_c.sent()).accessToken;\n                        _c.label = 2;\n                    case 2:\n                        if (action === 'storage.uploadFile') {\n                            payload = new FormData();\n                            for (key in payload) {\n                                if (payload.hasOwnProperty(key) && payload[key] !== undefined) {\n                                    payload.append(key, tmpObj[key]);\n                                }\n                            }\n                            contentType = 'multipart/form-data';\n                        }\n                        else {\n                            contentType = 'application/json;charset=UTF-8';\n                            payload = {};\n                            for (key in tmpObj) {\n                                if (tmpObj[key] !== undefined) {\n                                    payload[key] = tmpObj[key];\n                                }\n                            }\n                        }\n                        if (adapters_1.Adapter.runtime !== adapters_1.RUNTIME.WEB) {\n                            _b = this.config, appSign = _b.appSign, appSecret = _b.appSecret;\n                            timestamp = Date.now();\n                            appAccessKey = appSecret.appAccessKey, appAccessKeyId = appSecret.appAccessKeyId;\n                            sign = util_1.createSign({\n                                data: payload,\n                                timestamp: timestamp,\n                                appAccessKeyId: appAccessKeyId,\n                                appSign: appSign\n                            }, appAccessKey);\n                            payload = __assign(__assign({}, payload), { timestamp: timestamp,\n                                appAccessKey: appAccessKey,\n                                appSign: appSign,\n                                sign: sign });\n                        }\n                        opts = {\n                            headers: {\n                                'content-type': contentType\n                            }\n                        };\n                        if (options && options['onUploadProgress']) {\n                            opts.onUploadProgress = options['onUploadProgress'];\n                        }\n                        traceHeader = this._localCache.getStore(tcbTraceKey);\n                        if (traceHeader) {\n                            opts.headers['X-TCB-Trace'] = traceHeader;\n                        }\n                        parse = params.parse, inQuery = params.inQuery, search = params.search;\n                        formatQuery = {\n                            env: this.config.env\n                        };\n                        parse && (formatQuery.parse = true);\n                        inQuery && (formatQuery = __assign(__assign({}, inQuery), formatQuery));\n                        newUrl = util_1.formatUrl(types_1.protocol, types_1.BASE_URL, formatQuery);\n                        if (search) {\n                            newUrl += search;\n                        }\n                        return [4, this.post(__assign({ url: newUrl, data: payload }, opts))];\n                    case 3:\n                        res = _c.sent();\n                        resTraceHeader = res.header && res.header['x-tcb-trace'];\n                        if (resTraceHeader) {\n                            this._localCache.setStore(tcbTraceKey, resTraceHeader);\n                        }\n                        if ((Number(res.status) !== 200 && Number(res.statusCode) !== 200) || !res.data) {\n                            throw new Error('network request error');\n                        }\n                        return [2, res];\n                }\n            });\n        });\n    };\n    IRequest.prototype.send = function (action, data) {\n        if (data === void 0) { data = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var response, response_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this.request(action, data, { onUploadProgress: data.onUploadProgress })];\n                    case 1:\n                        response = _a.sent();\n                        if (!(response.data.code === 'ACCESS_TOKEN_EXPIRED' && actionsWithoutAccessToken.indexOf(action) === -1)) return [3, 4];\n                        return [4, this.refreshAccessToken()];\n                    case 2:\n                        _a.sent();\n                        return [4, this.request(action, data, { onUploadProgress: data.onUploadProgress })];\n                    case 3:\n                        response_1 = _a.sent();\n                        if (response_1.data.code) {\n                            throw new Error(\"[\" + response_1.data.code + \"] \" + response_1.data.message);\n                        }\n                        return [2, response_1.data];\n                    case 4:\n                        if (response.data.code) {\n                            throw new Error(\"[\" + response.data.code + \"] \" + response.data.message);\n                        }\n                        return [2, response.data];\n                }\n            });\n        });\n    };\n    return IRequest;\n}());\nexports.IRequest = IRequest;\nvar requestMap = {};\nfunction initRequest(config) {\n    requestMap[config.env] = new IRequest(config);\n}\nexports.initRequest = initRequest;\nfunction getRequestByEnvId(env) {\n    return requestMap[env];\n}\nexports.getRequestByEnvId = getRequestByEnvId;\n","\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar packageInfo = __importStar(require(\"../package.json\"));\nexports.SDK_VERISON = packageInfo.version;\nexports.ACCESS_TOKEN = 'access_token';\nexports.ACCESS_TOKEN_Expire = 'access_token_expire';\nexports.REFRESH_TOKEN = 'refresh_token';\nexports.ANONYMOUS_UUID = 'anonymous_uuid';\nexports.LOGIN_TYPE_KEY = 'login_type';\nexports.protocol = typeof location !== 'undefined' && location.protocol === 'http:' ? 'http:' : 'https:';\nexports.BASE_URL = process.env.NODE_ENV === 'e2e' && process.env.END_POINT === 'pre'\n    ? '//tcb-pre.tencentcloudapi.com/web'\n    : '//tcb-api.tencentcloudapi.com/web';\nexports.dataVersion = '2020-01-10';\n","module.exports = {\n  \"_from\": \"tcb-js-sdk@latest\",\n  \"_id\": \"tcb-js-sdk@1.6.1\",\n  \"_inBundle\": false,\n  \"_integrity\": \"sha512-yKRuihpyypyKuw2HHMtll6TG606sx18Ii3Z531BfcHIenDkY7akOCx/RDzzLTHNFiKMXdHauEmK2G/1kU3NtnA==\",\n  \"_location\": \"/tcb-js-sdk\",\n  \"_phantomChildren\": {},\n  \"_requested\": {\n    \"type\": \"tag\",\n    \"registry\": true,\n    \"raw\": \"tcb-js-sdk@latest\",\n    \"name\": \"tcb-js-sdk\",\n    \"escapedName\": \"tcb-js-sdk\",\n    \"rawSpec\": \"latest\",\n    \"saveSpec\": null,\n    \"fetchSpec\": \"latest\"\n  },\n  \"_requiredBy\": [\n    \"#USER\",\n    \"/\"\n  ],\n  \"_resolved\": \"https://registry.npmjs.org/tcb-js-sdk/-/tcb-js-sdk-1.6.1.tgz\",\n  \"_shasum\": \"8da2e7aedc11fa2358aadaebd98712838b211543\",\n  \"_spec\": \"tcb-js-sdk@latest\",\n  \"_where\": \"D:\\\\develop\\\\wx_xcx\\\\pmdog\\\\miniprogram\",\n  \"author\": {\n    \"name\": \"jimmyjzhang\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/TencentCloudBase/tcb-js-sdk/issues\"\n  },\n  \"bundleDependencies\": false,\n  \"dependencies\": {\n    \"@cloudbase/adapter-interface\": \"^0.4.0\",\n    \"@cloudbase/database\": \"0.9.11-rc.0\",\n    \"axios\": \"^0.19.1\",\n    \"cloudbase-adapter-wx_mp\": \"^0.1.0\",\n    \"crypto-js\": \"^3.1.9-1\",\n    \"fingerprintjs2\": \"^2.1.0\",\n    \"url\": \"^0.11.0\"\n  },\n  \"deprecated\": false,\n  \"description\": \"js sdk for tcb\",\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.6.2\",\n    \"@babel/plugin-proposal-class-properties\": \"^7.5.5\",\n    \"@babel/plugin-proposal-object-rest-spread\": \"^7.6.2\",\n    \"@babel/plugin-transform-runtime\": \"^7.6.2\",\n    \"@babel/preset-env\": \"^7.6.2\",\n    \"@babel/preset-typescript\": \"^7.6.0\",\n    \"@babel/runtime\": \"^7.6.2\",\n    \"@types/jest\": \"^23.1.4\",\n    \"@types/node\": \"^10.14.4\",\n    \"babel-eslint\": \"^10.0.1\",\n    \"babel-loader\": \"^8.0.6\",\n    \"dts-bundle\": \"^0.7.3\",\n    \"eslint\": \"^5.16.0\",\n    \"eslint-config-alloy\": \"^1.4.2\",\n    \"eslint-config-prettier\": \"^4.1.0\",\n    \"eslint-plugin-prettier\": \"^3.0.1\",\n    \"eslint-plugin-typescript\": \"^1.0.0-rc.3\",\n    \"express\": \"^4.17.1\",\n    \"husky\": \"^3.1.0\",\n    \"jest\": \"^24.7.1\",\n    \"jest-puppeteer\": \"^4.3.0\",\n    \"lint-staged\": \"^9.5.0\",\n    \"power-assert\": \"^1.6.1\",\n    \"puppeteer\": \"^1.20.0\",\n    \"serve-static\": \"^1.14.1\",\n    \"ts-jest\": \"^23.10.4\",\n    \"ts-loader\": \"^6.2.1\",\n    \"typescript\": \"^3.4.3\",\n    \"typescript-eslint-parser\": \"^22.0.0\",\n    \"webpack\": \"^4.41.3\",\n    \"webpack-bundle-analyzer\": \"^3.4.1\",\n    \"webpack-cli\": \"^3.3.0\",\n    \"webpack-dev-server\": \"^3.3.1\",\n    \"webpack-visualizer-plugin\": \"^0.1.11\"\n  },\n  \"homepage\": \"https://github.com/TencentCloudBase/tcb-js-sdk#readme\",\n  \"husky\": {\n    \"hooks\": {\n      \"pre-commit\": \"lint-staged\"\n    }\n  },\n  \"keywords\": [\n    \"tcb\",\n    \"js-sdk\"\n  ],\n  \"license\": \"ISC\",\n  \"lint-staged\": {\n    \"*.{js,ts}\": [\n      \"eslint --fix\",\n      \"git add\"\n    ]\n  },\n  \"main\": \"dist/index.js\",\n  \"name\": \"tcb-js-sdk\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/TencentCloudBase/tcb-js-sdk.git\"\n  },\n  \"scripts\": {\n    \"build\": \"npm run tsc && webpack\",\n    \"e2e\": \"NODE_ENV=e2e webpack && jest --config=\\\"./jest.e2e.config.js\\\"  --verbose false -i \\\"e2e\\\"\",\n    \"eslint\": \"eslint \\\"./**/*.js\\\" \\\"./**/*.ts\\\"\",\n    \"eslint-fix\": \"eslint --fix \\\"./**/*.js\\\" \\\"./**/*.ts\\\"\",\n    \"prepublish\": \"npm run tsc\",\n    \"start\": \"webpack-dev-server --hot --open\",\n    \"test\": \"jest --verbose false -i\",\n    \"test_web\": \"npm run tsc && webpack-dev-server --devtool eval-source-map --progress --colors --hot --inline --content-base ./dist --host jimmytest-088bef.tcb.qcloud.la --port 80 --disableHostCheck true --mode development --config webpack.test.js\",\n    \"tsc\": \"tsc -p tsconfig.json\",\n    \"tsc:w\": \"tsc -p tsconfig.json -w\"\n  },\n  \"types\": \"./dist/index.d.ts\",\n  \"version\": \"1.6.1\"\n}\n","\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar adapter_interface_1 = require(\"@cloudbase/adapter-interface\");\nvar adapters_1 = require(\"../adapters\");\nvar types_1 = require(\"../types\");\nvar util_1 = require(\"./util\");\nvar alwaysLocalKeys = ['anonymousUuidKey'];\nvar TcbObject = (function (_super) {\n    __extends(TcbObject, _super);\n    function TcbObject() {\n        var _this = _super.call(this) || this;\n        if (!adapters_1.Adapter.adapter.root['tcbObject']) {\n            adapters_1.Adapter.adapter.root['tcbObject'] = {};\n        }\n        return _this;\n    }\n    TcbObject.prototype.setItem = function (key, value) {\n        adapters_1.Adapter.adapter.root['tcbObject'][key] = value;\n    };\n    TcbObject.prototype.getItem = function (key) {\n        return adapters_1.Adapter.adapter.root['tcbObject'][key];\n    };\n    TcbObject.prototype.removeItem = function (key) {\n        delete adapters_1.Adapter.adapter.root['tcbObject'][key];\n    };\n    TcbObject.prototype.clear = function () {\n        delete adapters_1.Adapter.adapter.root['tcbObject'];\n    };\n    return TcbObject;\n}(adapter_interface_1.AbstractStorage));\nfunction createStorage(persistence, adapter) {\n    switch (persistence) {\n        case 'local':\n            return adapter.localStorage || new TcbObject();\n        case 'none':\n            return new TcbObject();\n        default:\n            return adapter.sessionStorage || new TcbObject();\n    }\n}\nvar ICache = (function () {\n    function ICache(config) {\n        this.keys = {};\n        if (!this._storage) {\n            this._persistence = adapters_1.Adapter.adapter.primaryStorage || config.persistence;\n            this._storage = createStorage(this._persistence, adapters_1.Adapter.adapter);\n            var accessTokenKey = types_1.ACCESS_TOKEN + \"_\" + config.env;\n            var accessTokenExpireKey = types_1.ACCESS_TOKEN_Expire + \"_\" + config.env;\n            var refreshTokenKey = types_1.REFRESH_TOKEN + \"_\" + config.env;\n            var anonymousUuidKey = types_1.ANONYMOUS_UUID + \"_\" + config.env;\n            var loginTypeKey = types_1.LOGIN_TYPE_KEY + \"_\" + config.env;\n            this.keys = {\n                accessTokenKey: accessTokenKey,\n                accessTokenExpireKey: accessTokenExpireKey,\n                refreshTokenKey: refreshTokenKey,\n                anonymousUuidKey: anonymousUuidKey,\n                loginTypeKey: loginTypeKey\n            };\n        }\n    }\n    ICache.prototype.updatePersistence = function (persistence) {\n        if (persistence === this._persistence) {\n            return;\n        }\n        var isCurrentLocal = this._persistence === 'local';\n        this._persistence = persistence;\n        var storage = createStorage(persistence, adapters_1.Adapter.adapter);\n        for (var key in this.keys) {\n            var name_1 = this.keys[key];\n            if (isCurrentLocal && alwaysLocalKeys.includes(key)) {\n                continue;\n            }\n            var val = this._storage.getItem(name_1);\n            if (!util_1.isUndefined(val) && !util_1.isNull(val)) {\n                storage.setItem(name_1, val);\n                this._storage.removeItem(name_1);\n            }\n        }\n        this._storage = storage;\n    };\n    ICache.prototype.setStore = function (key, value, version) {\n        if (!this._storage) {\n            return;\n        }\n        var d = {\n            version: version || 'localCachev1',\n            content: value\n        };\n        var content = JSON.stringify(d);\n        try {\n            this._storage.setItem(key, content);\n        }\n        catch (e) {\n            return;\n        }\n        return;\n    };\n    ICache.prototype.getStore = function (key, version) {\n        try {\n            if (process && process.env && process.env.tcb_token) {\n                return process.env.tcb_token;\n            }\n            if (!this._storage) {\n                return;\n            }\n        }\n        catch (e) {\n            return '';\n        }\n        version = version || 'localCachev1';\n        var content = this._storage.getItem(key);\n        if (!content) {\n            return '';\n        }\n        if (content.indexOf(version) >= 0) {\n            var d = JSON.parse(content);\n            return d.content;\n        }\n        else {\n            return '';\n        }\n    };\n    ICache.prototype.removeStore = function (key) {\n        this._storage.removeItem(key);\n    };\n    return ICache;\n}());\nexports.ICache = ICache;\nvar cacheMap = {};\nvar localCacheMap = {};\nfunction initCache(config) {\n    var env = config.env;\n    cacheMap[env] = new ICache(config);\n    localCacheMap[env] = new ICache(__assign(__assign({}, config), { persistence: 'local' }));\n}\nexports.initCache = initCache;\nfunction getCache(env) {\n    return cacheMap[env];\n}\nexports.getCache = getCache;\nfunction getLocalCache(env) {\n    return localCacheMap[env];\n}\nexports.getLocalCache = getLocalCache;\n","\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Web = __importStar(require(\"./platforms/web\"));\nvar util_1 = require(\"../lib/util\");\nvar RUNTIME;\n(function (RUNTIME) {\n    RUNTIME[\"WEB\"] = \"web\";\n    RUNTIME[\"WX_MP\"] = \"wx_mp\";\n})(RUNTIME = exports.RUNTIME || (exports.RUNTIME = {}));\nfunction useAdapters(adapters) {\n    var adapterList = util_1.isArray(adapters) ? adapters : [adapters];\n    for (var _i = 0, adapterList_1 = adapterList; _i < adapterList_1.length; _i++) {\n        var adapter = adapterList_1[_i];\n        var isMatch = adapter.isMatch, genAdapter = adapter.genAdapter, runtime = adapter.runtime;\n        if (isMatch()) {\n            return {\n                adapter: genAdapter(),\n                runtime: runtime\n            };\n        }\n    }\n}\nexports.useAdapters = useAdapters;\nfunction useDefaultAdapter() {\n    return {\n        adapter: Web.genAdapter(),\n        runtime: RUNTIME.WEB\n    };\n}\nexports.useDefaultAdapter = useDefaultAdapter;\nexports.Adapter = {\n    adapter: null,\n    runtime: undefined\n};\n","\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar adapter_interface_1 = require(\"@cloudbase/adapter-interface\");\nvar types_1 = require(\"../../types\");\nvar util_1 = require(\"../../lib/util\");\nvar WebRequest = (function (_super) {\n    __extends(WebRequest, _super);\n    function WebRequest(config) {\n        var _this = _super.call(this) || this;\n        var timeout = config.timeout, timeoutMsg = config.timeoutMsg, restrictedMethods = config.restrictedMethods;\n        _this._timeout = timeout || 0;\n        _this._timeoutMsg = timeoutMsg || '请求超时';\n        _this._restrictedMethods = restrictedMethods || ['get', 'post', 'upload', 'download'];\n        return _this;\n    }\n    WebRequest.prototype.get = function (options) {\n        return this._request(__assign(__assign({}, options), { method: 'get' }), this._restrictedMethods.includes('get'));\n    };\n    WebRequest.prototype.post = function (options) {\n        return this._request(__assign(__assign({}, options), { method: 'post' }), this._restrictedMethods.includes('post'));\n    };\n    WebRequest.prototype.put = function (options) {\n        return this._request(__assign(__assign({}, options), { method: 'put' }));\n    };\n    WebRequest.prototype.upload = function (options) {\n        var data = options.data, file = options.file, name = options.name;\n        var formData = new FormData();\n        for (var key in data) {\n            formData.append(key, data[key]);\n        }\n        formData.append('key', name);\n        formData.append('file', file);\n        return this._request(__assign(__assign({}, options), { data: formData, method: 'post' }), this._restrictedMethods.includes('upload'));\n    };\n    WebRequest.prototype.download = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var fileName, link;\n            return __generator(this, function (_a) {\n                fileName = decodeURIComponent(new URL(options.url).pathname.split('/').pop() || '');\n                link = document.createElement('a');\n                link.href = options.url;\n                link.setAttribute('download', fileName);\n                link.setAttribute('target', '_blank');\n                document.body.appendChild(link);\n                link.click();\n                return [2, new Promise(function (resolve) {\n                        resolve({\n                            statusCode: 200,\n                            tempFilePath: options.url\n                        });\n                    })];\n            });\n        });\n    };\n    WebRequest.prototype._request = function (options, enableAbort) {\n        var _this = this;\n        if (enableAbort === void 0) { enableAbort = false; }\n        var method = (String(options.method)).toLowerCase() || 'get';\n        return new Promise(function (resolve) {\n            var url = options.url, _a = options.headers, headers = _a === void 0 ? {} : _a, data = options.data, responseType = options.responseType, withCredentials = options.withCredentials, body = options.body, onUploadProgress = options.onUploadProgress;\n            var realUrl = util_1.formatUrl(types_1.protocol, url, method === 'get' ? data : {});\n            var ajax = new XMLHttpRequest();\n            ajax.open(method, realUrl);\n            responseType && (ajax.responseType = responseType);\n            for (var key in headers) {\n                ajax.setRequestHeader(key, headers[key]);\n            }\n            var timer;\n            if (onUploadProgress) {\n                ajax.addEventListener('progress', onUploadProgress);\n            }\n            ajax.onreadystatechange = function () {\n                var result = {};\n                if (ajax.readyState === 4) {\n                    var headers_1 = ajax.getAllResponseHeaders();\n                    var arr = headers_1.trim().split(/[\\r\\n]+/);\n                    var headerMap_1 = {};\n                    arr.forEach(function (line) {\n                        var parts = line.split(': ');\n                        var header = parts.shift().toLowerCase();\n                        var value = parts.join(': ');\n                        headerMap_1[header] = value;\n                    });\n                    result.header = headerMap_1;\n                    result.statusCode = ajax.status;\n                    try {\n                        result.data = JSON.parse(ajax.responseText);\n                    }\n                    catch (e) {\n                        result.data = ajax.responseText;\n                    }\n                    clearTimeout(timer);\n                    resolve(result);\n                }\n            };\n            if (enableAbort && _this._timeout) {\n                timer = setTimeout(function () {\n                    console.warn(_this._timeoutMsg);\n                    ajax.abort();\n                }, _this._timeout);\n            }\n            var payload;\n            if (util_1.isFormData(data)) {\n                payload = data;\n            }\n            else if (headers['content-type'] === 'application/x-www-form-urlencoded') {\n                payload = util_1.toQueryString(data);\n            }\n            else if (body) {\n                payload = body;\n            }\n            else {\n                payload = data ? JSON.stringify(data) : undefined;\n            }\n            if (withCredentials) {\n                ajax.withCredentials = true;\n            }\n            ajax.send(payload);\n        });\n    };\n    return WebRequest;\n}(adapter_interface_1.AbstractSDKRequest));\nexports.WebRequest = WebRequest;\nfunction genAdapter() {\n    var adapter = {\n        root: window,\n        reqClass: WebRequest,\n        wsClass: WebSocket,\n        localStorage: localStorage,\n        sessionStorage: sessionStorage\n    };\n    return adapter;\n}\nexports.genAdapter = genAdapter;\n","\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"./util\");\nfunction _addEventListener(name, listener, listeners) {\n    listeners[name] = listeners[name] || [];\n    listeners[name].push(listener);\n}\nfunction _removeEventListener(name, listener, listeners) {\n    if (listeners && listeners[name]) {\n        var index = listeners[name].indexOf(listener);\n        if (index !== -1) {\n            listeners[name].splice(index, 1);\n        }\n    }\n}\nvar IEvent = (function () {\n    function IEvent(name, data) {\n        this.data = data || null;\n        this.name = name;\n    }\n    return IEvent;\n}());\nexports.IEvent = IEvent;\nvar IErrorEvent = (function (_super) {\n    __extends(IErrorEvent, _super);\n    function IErrorEvent(error, data) {\n        var _this = _super.call(this, 'error', { error: error, data: data }) || this;\n        _this.error = error;\n        return _this;\n    }\n    return IErrorEvent;\n}(IEvent));\nexports.IErrorEvent = IErrorEvent;\nvar IEventEmitter = (function () {\n    function IEventEmitter() {\n        this._listeners = {};\n    }\n    IEventEmitter.prototype.on = function (name, listener) {\n        _addEventListener(name, listener, this._listeners);\n        return this;\n    };\n    IEventEmitter.prototype.off = function (name, listener) {\n        _removeEventListener(name, listener, this._listeners);\n        return this;\n    };\n    IEventEmitter.prototype.fire = function (event, data) {\n        if (util_1.isInstanceOf(event, IErrorEvent)) {\n            console.error(event.error);\n            return this;\n        }\n        var ev = util_1.isString(event) ? new IEvent(event, data || {}) : event;\n        var name = ev.name;\n        if (this._listens(name)) {\n            ev.target = this;\n            var handlers = this._listeners[name] ? __spreadArrays(this._listeners[name]) : [];\n            for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {\n                var fn = handlers_1[_i];\n                fn.call(this, ev);\n            }\n        }\n        return this;\n    };\n    IEventEmitter.prototype._listens = function (name) {\n        return this._listeners[name] && this._listeners[name].length > 0;\n    };\n    return IEventEmitter;\n}());\nexports.IEventEmitter = IEventEmitter;\nvar iEventEmitter = new IEventEmitter();\nfunction addEventListener(event, callback) {\n    iEventEmitter.on(event, callback);\n}\nexports.addEventListener = addEventListener;\nfunction activateEvent(event, data) {\n    if (data === void 0) { data = {}; }\n    iEventEmitter.fire(event, data);\n}\nexports.activateEvent = activateEvent;\nfunction removeEventListener(event, callback) {\n    iEventEmitter.off(event, callback);\n}\nexports.removeEventListener = removeEventListener;\nexports.EVENTS = {\n    LOGIN_STATE_CHANGED: 'loginStateChanged',\n    LOGIN_STATE_EXPIRED: 'loginStateExpire',\n    LOGIN_TYPE_CHANGED: 'loginTypeChanged',\n    ANONYMOUS_CONVERTED: 'anonymousConverted',\n    ACCESS_TOKEN_REFRESHD: 'refreshAccessToken'\n};\n","\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_1 = require(\"./base\");\nvar events_1 = require(\"../lib/events\");\nvar AnonymousAuthProvider = (function (_super) {\n    __extends(AnonymousAuthProvider, _super);\n    function AnonymousAuthProvider() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AnonymousAuthProvider.prototype.signIn = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, anonymousUuidKey, refreshTokenKey, anonymous_uuid, refresh_token, res;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this._cache.updatePersistence('local');\n                        _a = this._cache.keys, anonymousUuidKey = _a.anonymousUuidKey, refreshTokenKey = _a.refreshTokenKey;\n                        anonymous_uuid = this._cache.getStore(anonymousUuidKey) || undefined;\n                        refresh_token = this._cache.getStore(refreshTokenKey) || undefined;\n                        return [4, this._request.send('auth.signInAnonymously', {\n                                anonymous_uuid: anonymous_uuid,\n                                refresh_token: refresh_token\n                            })];\n                    case 1:\n                        res = _b.sent();\n                        if (!(res.uuid && res.refresh_token)) return [3, 3];\n                        this._setAnonymousUUID(res.uuid);\n                        this.setRefreshToken(res.refresh_token);\n                        return [4, this._request.refreshAccessToken()];\n                    case 2:\n                        _b.sent();\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_STATE_CHANGED);\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_TYPE_CHANGED, {\n                            env: this.config.env,\n                            loginType: base_1.LOGINTYPE.ANONYMOUS,\n                            persistence: 'local'\n                        });\n                        return [2, {\n                                credential: {\n                                    refreshToken: res.refresh_token\n                                }\n                            }];\n                    case 3: throw new Error('[tcb-js-sdk] 匿名登录失败');\n                }\n            });\n        });\n    };\n    AnonymousAuthProvider.prototype.linkAndRetrieveDataWithTicket = function (ticket) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, anonymousUuidKey, refreshTokenKey, uuid, refresh_token, res;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this._cache.keys, anonymousUuidKey = _a.anonymousUuidKey, refreshTokenKey = _a.refreshTokenKey;\n                        uuid = this._cache.getStore(anonymousUuidKey);\n                        refresh_token = this._cache.getStore(refreshTokenKey);\n                        return [4, this._request.send('auth.linkAndRetrieveDataWithTicket', {\n                                anonymous_uuid: uuid,\n                                refresh_token: refresh_token,\n                                ticket: ticket\n                            })];\n                    case 1:\n                        res = _b.sent();\n                        if (!res.refresh_token) return [3, 3];\n                        this._clearAnonymousUUID();\n                        this.setRefreshToken(res.refresh_token);\n                        return [4, this._request.refreshAccessToken()];\n                    case 2:\n                        _b.sent();\n                        events_1.activateEvent(events_1.EVENTS.ANONYMOUS_CONVERTED, { env: this.config.env });\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_TYPE_CHANGED, { loginType: base_1.LOGINTYPE.CUSTOM, persistence: 'local' });\n                        return [2, {\n                                credential: {\n                                    refreshToken: res.refresh_token\n                                }\n                            }];\n                    case 3: throw new Error('[tcb-js-sdk] 匿名转化失败');\n                }\n            });\n        });\n    };\n    AnonymousAuthProvider.prototype._setAnonymousUUID = function (id) {\n        var _a = this._cache.keys, anonymousUuidKey = _a.anonymousUuidKey, loginTypeKey = _a.loginTypeKey;\n        this._cache.removeStore(anonymousUuidKey);\n        this._cache.setStore(anonymousUuidKey, id);\n        this._cache.setStore(loginTypeKey, base_1.LOGINTYPE.ANONYMOUS);\n    };\n    AnonymousAuthProvider.prototype._clearAnonymousUUID = function () {\n        this._cache.removeStore(this._cache.keys.anonymousUuidKey);\n    };\n    return AnonymousAuthProvider;\n}(base_1.AuthProvider));\nexports.AnonymousAuthProvider = AnonymousAuthProvider;\n","\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_1 = require(\"./base\");\nvar events_1 = require(\"../lib/events\");\nvar CustomAuthProvider = (function (_super) {\n    __extends(CustomAuthProvider, _super);\n    function CustomAuthProvider() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CustomAuthProvider.prototype.signIn = function (ticket) {\n        return __awaiter(this, void 0, void 0, function () {\n            var refreshTokenKey, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (typeof ticket !== 'string') {\n                            throw new Error('ticket must be a string');\n                        }\n                        refreshTokenKey = this._cache.keys.refreshTokenKey;\n                        return [4, this._request.send('auth.signInWithTicket', {\n                                ticket: ticket,\n                                refresh_token: this._cache.getStore(refreshTokenKey) || ''\n                            })];\n                    case 1:\n                        res = _a.sent();\n                        if (!res.refresh_token) return [3, 3];\n                        this.setRefreshToken(res.refresh_token);\n                        return [4, this._request.refreshAccessToken()];\n                    case 2:\n                        _a.sent();\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_STATE_CHANGED);\n                        events_1.activateEvent(events_1.EVENTS.LOGIN_TYPE_CHANGED, {\n                            env: this.config.env,\n                            loginType: base_1.LOGINTYPE.CUSTOM,\n                            persistence: this.config.persistence\n                        });\n                        return [2, {\n                                credential: {\n                                    refreshToken: res.refresh_token\n                                }\n                            }];\n                    case 3: throw new Error('[tcb-js-sdk] 自定义登录失败');\n                }\n            });\n        });\n    };\n    return CustomAuthProvider;\n}(base_1.AuthProvider));\nexports.CustomAuthProvider = CustomAuthProvider;\n","\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar request_1 = require(\"../lib/request\");\nvar util_1 = require(\"../lib/util\");\nexports.uploadFile = function (params, callback) {\n    callback = callback || util_1.createPromiseCallback();\n    var request = request_1.getRequestByEnvId(this.config.env);\n    var metaData = 'storage.getUploadMetadata';\n    var cloudPath = params.cloudPath, filePath = params.filePath, onUploadProgress = params.onUploadProgress;\n    request\n        .send(metaData, {\n        path: cloudPath\n    })\n        .then(function (metaData) {\n        var _a = metaData.data, url = _a.url, authorization = _a.authorization, token = _a.token, fileId = _a.fileId, cosFileId = _a.cosFileId, requestId = metaData.requestId;\n        var data = {\n            key: cloudPath,\n            signature: authorization,\n            'x-cos-meta-fileid': cosFileId,\n            'success_action_status': '201',\n            'x-cos-security-token': token\n        };\n        request.upload({\n            url: url,\n            data: data,\n            file: filePath,\n            name: cloudPath,\n            onUploadProgress: onUploadProgress\n        }).then(function (res) {\n            if (res.statusCode === 201) {\n                callback(null, {\n                    fileID: fileId,\n                    requestId: requestId\n                });\n            }\n            else {\n                callback(new Error(\"STORAGE_REQUEST_FAIL: \" + res.data));\n            }\n        })\n            .catch(function (err) {\n            callback(err);\n        });\n    })\n        .catch(function (err) {\n        callback(err);\n    });\n    return callback.promise;\n};\nexports.getUploadMetadata = function (params, callback) {\n    callback = callback || util_1.createPromiseCallback();\n    var request = request_1.getRequestByEnvId(this.config.env);\n    var metaData = 'storage.getUploadMetadata';\n    var cloudPath = params.cloudPath;\n    request\n        .send(metaData, {\n        path: cloudPath\n    })\n        .then(function (metaData) {\n        callback(null, metaData);\n    })\n        .catch(function (err) {\n        callback(err);\n    });\n    return callback.promise;\n};\nexports.deleteFile = function (_a, callback) {\n    var fileList = _a.fileList;\n    callback = callback || util_1.createPromiseCallback();\n    if (!fileList || !Array.isArray(fileList)) {\n        return {\n            code: 'INVALID_PARAM',\n            message: 'fileList必须是非空的数组'\n        };\n    }\n    for (var _i = 0, fileList_1 = fileList; _i < fileList_1.length; _i++) {\n        var file = fileList_1[_i];\n        if (!file || typeof file !== 'string') {\n            return {\n                code: 'INVALID_PARAM',\n                message: 'fileList的元素必须是非空的字符串'\n            };\n        }\n    }\n    var action = 'storage.batchDeleteFile';\n    var params = {\n        fileid_list: fileList\n    };\n    var request = request_1.getRequestByEnvId(this.config.env);\n    request\n        .send(action, params)\n        .then(function (res) {\n        if (res.code) {\n            callback(null, res);\n        }\n        else {\n            callback(null, {\n                fileList: res.data.delete_list,\n                requestId: res.requestId\n            });\n        }\n    })\n        .catch(function (err) {\n        callback(err);\n    });\n    return callback.promise;\n};\nexports.getTempFileURL = function (_a, callback) {\n    var fileList = _a.fileList;\n    callback = callback || util_1.createPromiseCallback();\n    if (!fileList || !Array.isArray(fileList)) {\n        callback(null, {\n            code: 'INVALID_PARAM',\n            message: 'fileList必须是非空的数组'\n        });\n    }\n    var file_list = [];\n    for (var _i = 0, fileList_2 = fileList; _i < fileList_2.length; _i++) {\n        var file = fileList_2[_i];\n        if (typeof file === 'object') {\n            if (!file.hasOwnProperty('fileID') || !file.hasOwnProperty('maxAge')) {\n                callback(null, {\n                    code: 'INVALID_PARAM',\n                    message: 'fileList的元素必须是包含fileID和maxAge的对象'\n                });\n            }\n            file_list.push({\n                fileid: file.fileID,\n                max_age: file.maxAge\n            });\n        }\n        else if (typeof file === 'string') {\n            file_list.push({\n                fileid: file\n            });\n        }\n        else {\n            callback(null, {\n                code: 'INVALID_PARAM',\n                message: 'fileList的元素必须是字符串'\n            });\n        }\n    }\n    var action = 'storage.batchGetDownloadUrl';\n    var params = {\n        file_list: file_list\n    };\n    var request = request_1.getRequestByEnvId(this.config.env);\n    request\n        .send(action, params)\n        .then(function (res) {\n        if (res.code) {\n            callback(null, res);\n        }\n        else {\n            callback(null, {\n                fileList: res.data.download_list,\n                requestId: res.requestId\n            });\n        }\n    })\n        .catch(function (err) {\n        callback(err);\n    });\n    return callback.promise;\n};\nexports.downloadFile = function (_a, callback) {\n    var fileID = _a.fileID;\n    return __awaiter(this, void 0, void 0, function () {\n        var tmpUrlRes, res, request, tmpUrl, result;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0: return [4, exports.getTempFileURL.call(this, {\n                        fileList: [\n                            {\n                                fileID: fileID,\n                                maxAge: 600\n                            }\n                        ]\n                    })];\n                case 1:\n                    tmpUrlRes = _b.sent();\n                    res = tmpUrlRes.fileList[0];\n                    if (res.code !== 'SUCCESS') {\n                        return [2, callback ? callback(res) : new Promise(function (resolve) { resolve(res); })];\n                    }\n                    request = request_1.getRequestByEnvId(this.config.env);\n                    tmpUrl = res.download_url;\n                    tmpUrl = encodeURI(tmpUrl);\n                    if (!callback) return [3, 3];\n                    return [4, request.download({ url: tmpUrl })];\n                case 2:\n                    result = _b.sent();\n                    callback(result);\n                    return [3, 4];\n                case 3: return [2, request.download({ url: tmpUrl })];\n                case 4: return [2];\n            }\n        });\n    });\n};\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar request_1 = require(\"../lib/request\");\nvar util_1 = require(\"../lib/util\");\nexports.callFunction = function (_a, callback) {\n    var name = _a.name, data = _a.data, query = _a.query, parse = _a.parse, search = _a.search;\n    var promisedCallback = callback || util_1.createPromiseCallback();\n    var jsonData;\n    try {\n        jsonData = data ? JSON.stringify(data) : '';\n    }\n    catch (e) {\n        return Promise.reject(e);\n    }\n    if (!name) {\n        return Promise.reject(new Error('函数名不能为空'));\n    }\n    var action = 'functions.invokeFunction';\n    var params = {\n        inQuery: query,\n        parse: parse,\n        search: search,\n        function_name: name,\n        request_data: jsonData\n    };\n    var request = request_1.getRequestByEnvId(this.config.env);\n    request\n        .send(action, params)\n        .then(function (res) {\n        if (res.code) {\n            promisedCallback(null, res);\n        }\n        else {\n            var result = res.data.response_data;\n            if (parse) {\n                promisedCallback(null, {\n                    result: result,\n                    requestId: res.requestId\n                });\n            }\n            else {\n                try {\n                    result = JSON.parse(res.data.response_data);\n                    promisedCallback(null, {\n                        result: result,\n                        requestId: res.requestId\n                    });\n                }\n                catch (e) {\n                    promisedCallback(new Error('response data must be json'));\n                }\n            }\n        }\n        return promisedCallback.promise;\n    })\n        .catch(function (err) {\n        promisedCallback(err);\n    });\n    return promisedCallback.promise;\n};\n"]}